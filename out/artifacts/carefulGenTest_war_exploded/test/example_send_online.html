<!DOCTYPE html>
<html>
  <head>
    <title>样本回寄</title>
	
    <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	
	<link rel="stylesheet" type="text/css" href="../css/exam.css">
	<link rel="stylesheet" type="text/css" href="../css/pintuer.css" />
    <link rel="stylesheet" type="text/css" href="../css/shop.css" />
    
    <style type="text/css">
      .yanzhengma {font-size: 14px; border: none;background-color: #67C7BE;color: #fff;border-radius: 8px; }
      .yanzhengma:disabled { background-color: #ddd; }
      progress{
          width: 100%;
          height: 5px;
          color:#f00;
          background:#EFEFF4;
          border-radius: 0.1rem;
       }
       progress::-webkit-progress-bar{
          background-color: #f2f2f2;
          border-radius: 0.2rem;
       }
       progress::-webkit-progress-value{
          background: #74CFC8;
          border-radius: 0.2rem;
       }
       
       /*input框*/
       input, button {
           border: none;
           outline: none;
       }
       .tl-price-input{
           width: 100%;
           border: 1px solid #ccc;
           padding: 7px 0;
           background: #F4F4F7;
           border-radius: 3px;
           padding-left:5px;
           -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
           box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
           -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
           -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
           transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s
       }
       .tl-price-input:focus{
           border-color: #66afe9;
           outline: 0;
           -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);
           box-shadow: inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)
       }
    </style>

  </head>
  
  <body>
    <div style="width:96%;height:auto;float:left;margin-left:2%;margin-top:10px">
    <div style="width:100%;height:auto;float:left;">
       <div style="width:20%;font-size:15px;color:#74CFC8;float:left">样本绑定</div>
       <div style="width:20%;font-size:15px;color:#74CFC8;float:left;margin-left:6%;">样本采集</div>
       <div style="width:20%;font-size:15px;color:#74CFC8;float:left;margin-left:6%;">样本回寄</div>
       <div style="width:20%;font-size:15px;color:#A2A2A2;float:left;margin-left:6%;">样本检测</div>
    </div>
    <div style="width:100%;height:auto;float:left" class="content">
      <progress value="65" max="100">
      </progress>
    </div>

    <div style="width:100%;height:auto;float:left;margin-top:3%;">
       <div style="width:100%;height:auto;font-size:15px;margin-top:0%;color: #67C7BE">在线预约：您可在线预约顺丰上门取件</div>
       <div style="width:100%;height:auto;font-size:15px;margin-top:2%;">1.寄回费用由卡尤迪到付</div>
       <div style="width:100%;height:auto;font-size:15px;margin-top:2%;">2.请填写<a style="color:red">取件地址</a>，顺丰小哥会在两小时内上门取件</div>
    </div>
   
   <div style="width:100%;height:auto;float:left;margin-top:3%;">
        <h4 style="margin-top: 0%; margin-bottom: 0%;">省份</h4>
		<select class="selector" style="height:40px;background-color:#F4F4F7;border: 1px solid #ccc;margin-top:3%;" id="province" onfocus="setToTopfirst(this)" onblur="resume()">
			<option>省份(必选)</option>
		</select>
		<s></s>
	</div>
	<div style="width:100%;height:auto;float:left;margin-top:3%;">
        <h4 style="margin-top: 0%; margin-bottom: 0%;" onfocus="setToTopfirst(this)" onblur="resume()">城市</h4>
		<select class="selector" style="height:40px;background-color:#F4F4F7;border: 1px solid #ccc;margin-top:3%;" id="city">
			<option>城市</option>
		</select>
		<s></s>
	</div>
	<div style="width:100%;height:auto;float:left;margin-top:3%;">
        <h4 style="margin-top: 0%; margin-bottom: 0%;" onfocus="setToTopfirst(this)" onblur="resume()">县区</h4>
		<select class="selector" style="height:40px;background-color:#F4F4F7;border: 1px solid #ccc;margin-top:3%;" id="county">
			<option>县区</option>
		</select>
		<s></s>
	</div>

	<div style="width:100%;height:auto;float:left;margin-top:3%;">
       <h4 style="margin-top: 0%; margin-bottom: 0%;">详细地址</h4>
       <div style="width:100%;height:auto;float:left;margin-top:3%;">
         <input id="address" class="tl-price-input" type="text" value="" placeholder="请填写您的详细地址" onfocus="setToTopfirst(this)" onblur="resume()"/>
       </div>
	</div>
	
  </div>
  <div style="width:96%;float:left;height:65px;">
     
   </div>
  <div style="width:96%;height:auto;float:left;margin-right:2%;">
    <footer style="width:100%;margin-bottom:1%;" class="bg-white foot-height clearfix" onclick="goSubmit()" id="footer" style="z-index:10;">
      <div style="width:100%;float:left">
         <div style="width:94%;float:left;margin-left:3%;border-radius:10px;"  class="shop-goods-add text-white bg-main text-center" >提&nbsp;&nbsp;&nbsp;&nbsp;交</div>
      </div>
    </footer>    
  </div>
  <script type="text/javascript" src="../js/jquery.js"></script>
  <script src="../js/input.js" type="text/javascript"></script>
  <script type="text/javascript" src="../js/common.js"></script>
  <script>
  	var Request = new Object();
	Request = GetRequest();
	var open_id = Request["open_id"] == undefined ? "" : Request["open_id"];
    var sample_id = Request["sample_id"] == undefined ? "" : Request["sample_id"];
   /*  getUserId();
	function getUserId(){
		$.ajax({
	        url: "../api/getUserId.hn?user_id=" + open_id,
	   		type: "get",
	   		async: false,
	   		dataType: "json",
	   		success: function(data){
	   	    	if(data.success && data.code == "200"){
	   	    		open_id = data.msg;
	   	    		getProvince();
	   	    	}else if(data.success && data.code == "199"){
	   	    		window.location = data.msg;
	   	    	}else{
	   	    		alert(data.msg);
	   	    	}
	   	    }
		});
	}
	 */
	getProvince();
	var aaa=0;
	 //聚焦时置顶
	function setToTopfirst(ele) { 
	   aaa = $(ele).offset().top;
	}
	//失去焦点时恢复位置
	function resume(){
	  window.scrollTo(0,aaa);
	}
  
    function goSubmit(){   
         if($("#province option:selected").val()==0){
		    document.getElementById('province').focus();
			alert("省不能为空");
			return;
		}
		if($("#city option:selected").val()==0){
		    document.getElementById('city').focus();
			alert("城市不能为空");
			return;
		}
		if($("#address").val()==0){
		    document.getElementById('address').focus();
			alert("地址不能为空");
			return;
		}
		
		var province=$("#province option:selected").text();
		var city=$("#city option:selected").text();
		var county=$("#county option:selected").text();
		var address=$("#address").val();

		$.ajax({
	        url: "../express/appointmentExpress.hn",
	        data: {
	    	   	"province":province,
	        	"city":city,
	            "county":county,
	            "address":address,
	            "sample_id":sample_id
	        },
	        type: 'post',
	        dataType: "json",
	        success: function(data){
	            if(data.success){
	            	alert("预约成功");
	            	// 跳转到所有检测页面
	            	var url="./example_exam.html?open_id="+open_id;
	            	window.location = url;
	   	    	}else{
	   	    		alert(data.msg);
	   	    	}
	        }
	    });
    }
    
  
	// 获取信息
	function getProvince(){
		$.ajax({
	        url: "../api/getProvince.hn",
	   		type: "POST",
	   		dataType: "json",
	   		success: function(data){
	   	    	if(data.success){
	   	    		emptyProvince();
				    $.each(data.msg, function(i, elt) {
			   	        $("#province").append($("<option/>").text(elt.province_name).attr("value",elt.province_id));
			        });
	   	    	}else{
	   	    		alert(data.msg);
	   	    	}
	   	    }
		});
	}
	
	function getCity(province_id){
		$.ajax({
	        url: "../api/getCity.hn",
	   		type: "POST",
	   		data: {"province_id":province_id },
	   		dataType: "json",
	   		success: function(data){
	   	    	if(data.success){
	   	    		emptyCity();
				    $.each(data.msg, function(i, elt) {
						$("#city").append($("<option/>").text(elt.city_name).attr("value",elt.city_id));
					});
					setCity();
	   	    	}else{
	   	    		alert(data.msg);
	   	    	}
	   	    }
		});
	}
	
	function getCounty(city_id){
	    $.ajax({
	        url: "../api/getCounty.hn",
	   		type: "POST",
	   		data: {"city_id":city_id },
	   		dataType: "json",
	   		success: function(data){
	   	    	if(data.success){
	   	    		emptyCounty();
				    $.each(data.msg, function(i, elt) {
						$("#county").append($("<option/>").text(elt.county_name).attr("value",elt.county_id));
					});
					setCounty();
	   	    	}else{
	   	    		alert(data.msg);
	   	    	}
	   	    }
		});
	}
	
	// 设置信息
	function setProvince(){
		$("#province option").each(function(i,elt) {
	   	  	if(province==elt.text){
	    	  	$("#province").val(elt.value);
	    	  	province="";
	    	  	$("#province").change();
	    	};
		});
	}
	function setCity(){
		$("#city option").each(function(i,elt) {
	   	  	if(city==elt.text){
	    	  	$("#city").val(elt.value);
	    	  	city="";
	    	};
		});
	}
	function setCounty(){
		$("#county option").each(function(i,elt) {
	   	  	if(county==elt.text){
	    	  	//alert(county+","+elt.text+","+elt.value);
	    	  	county="";
	    	  	$("#county").val(elt.value);
	    	};
		});
	}
	
	
	// 清空选择
	function emptyProvince(){
		$("#province").empty();
		$("#province").append($("<option/>").text("省份").attr("value",0));
	}
	function emptyCity(){
		$("#city").empty();
		$("#city").append($("<option/>").text("城市").attr("value",0));
	}
	function emptyCounty(){
		$("#county").empty();
		$("#county").append($("<option/>").text("县区").attr("value",0));
	}
	
	//选项改变
	$("#province").change(function(e) {
		getCity($("#province").val());
		e.stopPropagation();
	});
	$("#city").change(function(e) {
		getCounty($("#city").val());
		e.stopPropagation();
	});
  </script>
  </body>
</html>
